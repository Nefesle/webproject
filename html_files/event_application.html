<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ | –í–µ–ª–æ–∫–ª—É–± "–°–æ—Ç–Ω—è"</title>
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        body {
            margin: 0;
            padding: 20px;
            background-image: url('/static/background_base.jpg');
            background-size: cover;
            background-position: center 15%;
            background-repeat: no-repeat;
            background-color: rgba(255, 255, 255, 0.5);
            background-blend-mode: lighten;
            color: #000;
            font-family: sans-serif;
            position: relative;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            min-height: 100vh;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞—è–≤–∫–∏ */
        .application-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å" */
        .home-button-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10;
        }

        .home-button {
            display: inline-block;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #e9b50b;
            border: none;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.3s, transform 0.2s;
        }

        .home-button:hover {
            background-color: #d8a50b;
        }

        .home-button:active {
            transform: scale(0.95);
        }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π */
        .calendar-container {
            margin-top: 10px;
            background-color: #333;
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        .event-date {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #e9b50b;
            color: #fff;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .event-date:hover {
            background-color: #d8a50b;
        }

        .event-date.selected {
            background-color: #2ecc71;
        }

        .date {
            font-weight: bold;
        }

        .event-date ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .event-date li {
            margin-bottom: 5px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
        .input-field {
            margin-bottom: 5px;
            margin-top: 10px;
            width: 100%;
            padding: 10px -10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s;
        }

        .input-field:focus {
            border-color: #e9b50b;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–ª–∞–∂–∫–∞ */
        form input[type="checkbox"] {
            margin-right: 10px;
            margin-top: 10px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã */
        .submit-button {
            margin-top: 10px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #e9b50b;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .submit-button:hover {
            background-color: #d8a50b;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            z-index: 999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 400px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .modal-content ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .modal-content li {
            margin-bottom: 5px;
        }

        .selected-date-container {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞—Ç—ã */
        #changeDateButton {
            margin-left: 10px;
            padding: 10px 15px;
            font-size: 14px;
            color: #fff;
            background-color: #e9b50b;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #changeDateButton:hover {
            background-color: #d8a50b;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã (–∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç) */
        .event-date.selected {
            background-color: #2ecc71;
            pointer-events: none; /* –ó–∞–ø—Ä–µ—Ç –∫–ª–∏–∫–æ–≤ */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç */
        .event-date {
            background-color: #e9b50b; /* –ñ—ë–ª—Ç—ã–π —Ñ–æ–Ω */
            color: white;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .event-date:hover {
            background-color: #d8a50b; /* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞—Ç */
        .event-date.disabled {
            background-color: #2ecc71; /* –ó–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω */
            cursor: not-allowed; /* –ú–µ–Ω—è–µ–º –∫—É—Ä—Å–æ—Ä */
            pointer-events: none; /* –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ */
        }

        .flash-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }

        .flash {
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            position: relative;
            animation: slideIn 0.3s ease-out, fadeOut 0.3s ease-in 5s forwards;
            opacity: 1;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π */
        .flash.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .flash.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .flash.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è */
        @keyframes fadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å" -->
    <div class="home-button-container">
        <a href="/profile" class="home-button">‚Üê –ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
    </div>

    <!-- –§–æ—Ä–º–∞ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏ -->
    <div class="application-container">
        <h1>üö¥ –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h1>
        <form action="/event-application" method="post">

            <input type="hidden" id="selectedDateInput" name="selected_date" value="">
            <input type="hidden" id="selectedDistanceInput" name="selected_distance" value="">

            <!-- –ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è (–±–µ—Ä—É—Ç—Å—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è) -->
            <div class="form-section">
                <label for="first_name">–ò–º—è:</label>
                <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" readonly class="input-field">
            </div>
            <div class="form-section">
                <label for="last_name">–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" readonly class="input-field">
            </div>

        <!-- –ë–ª–æ–∫ –¥–ª—è flash-—Å–æ–æ–±—â–µ–Ω–∏–π -->
        <div class="flash-container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <ul>
                        {% for category, message in messages %}
                            <li class="flash {{ category }}">{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endwith %}
        </div>

        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
        <div class="calendar-container" id="calendarContainer">
            <h2>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h2>
            <div class="calendar">
                {% for date, distances in events.items() %}
                    <div class="event-date" data-event-id="{{ date }}">
                        <span class="date">{{ date }}</span>
                        <ul>
                            {% for distance in distances %}
                                <li>{{ distance }} </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- –í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏—è -->
        <div class="selected-date-container" id="selectedDateContainer" style="display: none;">
            <p>
                <strong>–í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞:</strong> <span id="selectedDate"></span><br>
                <strong>–î–∏—Å—Ç–∞–Ω—Ü–∏—è:</strong> <span id="selectedDistance"></span>
            </p>
            <button id="changeDateButton">–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞—Ç—É</button>
        </div>


            <!-- –ì–∞–ª–æ—á–∫–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞ –º–µ–¥–∞–ª–∏ -->
            <div class="form-section">
                <label for="medal">
                    <input type="checkbox" id="medal" name="medal" value="yes"> –ó–∞–∫–∞–∑–∞—Ç—å –º–µ–¥–∞–ª—å
                </label>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã -->
            <button type="submit" class="submit-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ -->
    <div class="modal-overlay" id="distanceModal" style="display: none;">
        <div class="modal-content">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é:</h2>
            <ul></ul>
            <button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ JSON-–¥–∞–Ω–Ω—ã—Ö –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö
        const eventsData = {
            "19.04": [200],
            "03.05": [300, 200],
            "17.05": [300],
            "31.05": [400, 200],
            "14.06": [300],
            "28.06": [600, 200],
            "12.07": [1000, 300],
            "19.07": [200],
            "02.08": [300, 200],
            "16.08": [400, 300],
            "06.09": [200]
        };

        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
        let selectedDate = null;
        let selectedDistance = null;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function showCalendar() {
            document.getElementById('calendarContainer').style.display = 'block';
            document.getElementById('selectedDateContainer').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function hideCalendar() {
            document.getElementById('calendarContainer').style.display = 'none';
            document.getElementById('selectedDateContainer').style.display = 'flex';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ –¥–∞—Ç—É
        document.querySelectorAll('.event-date').forEach(dateElement => {
            dateElement.addEventListener('click', () => {
                const date = dateElement.getAttribute('data-event-id');

                // –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
                const distances = eventsData[date];

                // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                if (distances.length > 1) {
                    showDistanceModal(date, distances);
                } else {
                    // –ï—Å–ª–∏ –æ–¥–Ω–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏—è, –≤—ã–±–∏—Ä–∞–µ–º –µ—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                    selectDateAndDistance(date, distances[0]);
                }
            });
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –≤—ã–±–æ—Ä–æ–º –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
        function showDistanceModal(date, distances) {
            const modal = document.getElementById('distanceModal');
            modal.style.display = 'flex';

            const modalContent = modal.querySelector('.modal-content ul');
            modalContent.innerHTML = '';

            distances.forEach(distance => {
                const li = document.createElement('li');
                const link = document.createElement('a');
                link.href = '#';
                link.textContent = `${distance} –∫–º`;
                link.dataset.distance = distance;
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    selectDateAndDistance(date, distance);
                    closeModal();
                });
                li.appendChild(link);
                modalContent.appendChild(li);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
        function selectDateAndDistance(date, distance) {
            selectedDate = date;
            selectedDistance = distance;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            document.getElementById('selectedDateInput').value = selectedDate;
            document.getElementById('selectedDistanceInput').value = selectedDistance;

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é
            document.getElementById('selectedDate').textContent = selectedDate;
            document.getElementById('selectedDistance').textContent = `${selectedDistance} –∫–º`;

            // –°–∫—Ä—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            hideCalendar();

            // –ú–∞—Ä–∫–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –∫–∞–∫ "selected"
            document.querySelectorAll('.event-date').forEach(el => el.classList.remove('selected'));
            const selectedDateElement = document.querySelector(`[data-event-id="${selectedDate}"]`);
            if (selectedDateElement) {
                selectedDateElement.classList.add('selected');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            document.getElementById('distanceModal').style.display = 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞—Ç—ã
        document.getElementById('changeDateButton').addEventListener('click', () => {
            showCalendar();
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–∞—Ç–∞–º
            document.querySelectorAll('.event-date:not(.disabled)').forEach(dateElement => {
                dateElement.addEventListener('click', () => {
                    const date = dateElement.getAttribute('data-event-id');
                    const distances = eventsData[date];

                    if (distances.length > 1) {
                        showDistanceModal(date, distances);
                    } else {
                        selectDateAndDistance(date, distances[0]);
                    }
                });
            });
        });
    </script>
</body>
</html>